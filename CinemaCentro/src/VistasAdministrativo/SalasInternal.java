/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package VistasAdministrativo;

import Controlador.SalaDAO;
import Modelo.Sala;
import java.util.List;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import static javax.swing.JOptionPane.YES_NO_OPTION;
import javax.swing.JTable;
import javax.swing.SwingUtilities;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Enzo_2
 */
public class SalasInternal extends javax.swing.JInternalFrame {

    /**
     * Creates new form SalasInternal
     */
    SalaDAO maniSalas = new SalaDAO();
    private int nro_sala = -1;
    public SalasInternal() {
        initComponents();
        rellenarCabeceras();
        deshabilitarBotones();
        rellenarTabla();
        agregarListenerTablaSala(tblSalas);
        txtEstado.setEnabled(false);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnlSalas = new javax.swing.JPanel();
        lblNumero = new javax.swing.JLabel();
        lblCapacidad = new javax.swing.JLabel();
        lblEstado = new javax.swing.JLabel();
        lblApta3D = new javax.swing.JLabel();
        txtNumero = new javax.swing.JTextField();
        txtCapacidad = new javax.swing.JTextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblSalas = new javax.swing.JTable();
        btnAgregar = new javax.swing.JButton();
        checkEdicion = new javax.swing.JCheckBox();
        btnEliminar = new javax.swing.JButton();
        btnModificar = new javax.swing.JButton();
        checkApta3D = new javax.swing.JCheckBox();
        btnAlta = new javax.swing.JButton();
        btnBaja = new javax.swing.JButton();
        btnSalir = new javax.swing.JButton();
        lblSalasActuales = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        txtEstado = new javax.swing.JTextField();

        lblNumero.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        lblNumero.setText("Numero de sala:");

        lblCapacidad.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        lblCapacidad.setText("Capacidad de sala:");

        lblEstado.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        lblEstado.setText("Estado:");

        lblApta3D.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        lblApta3D.setText("Apta 3D:");

        tblSalas.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        jScrollPane1.setViewportView(tblSalas);

        btnAgregar.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        btnAgregar.setText("Agregar sala");
        btnAgregar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAgregarActionPerformed(evt);
            }
        });

        checkEdicion.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        checkEdicion.setText("Habilitar modificación");
        checkEdicion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                checkEdicionActionPerformed(evt);
            }
        });

        btnEliminar.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        btnEliminar.setText("Eliminar sala");
        btnEliminar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEliminarActionPerformed(evt);
            }
        });

        btnModificar.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        btnModificar.setText("Modificar sala");
        btnModificar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnModificarActionPerformed(evt);
            }
        });

        checkApta3D.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        checkApta3D.setText("Seleccionar si es apta");

        btnAlta.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        btnAlta.setText("Dar de alta sala");
        btnAlta.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAltaActionPerformed(evt);
            }
        });

        btnBaja.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        btnBaja.setText("Dar de baja sala");
        btnBaja.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnBajaActionPerformed(evt);
            }
        });

        btnSalir.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        btnSalir.setText("Salir");
        btnSalir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSalirActionPerformed(evt);
            }
        });

        lblSalasActuales.setFont(new java.awt.Font("Roboto Black", 1, 12)); // NOI18N
        lblSalasActuales.setText("Salas actuales:");

        jLabel1.setText("Minimo: 170");

        jLabel2.setText("Maximo: 230");

        javax.swing.GroupLayout pnlSalasLayout = new javax.swing.GroupLayout(pnlSalas);
        pnlSalas.setLayout(pnlSalasLayout);
        pnlSalasLayout.setHorizontalGroup(
            pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlSalasLayout.createSequentialGroup()
                .addGap(19, 19, 19)
                .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnlSalasLayout.createSequentialGroup()
                        .addGap(6, 6, 6)
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(btnAgregar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(btnEliminar, javax.swing.GroupLayout.DEFAULT_SIZE, 127, Short.MAX_VALUE))
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pnlSalasLayout.createSequentialGroup()
                                .addGap(8, 8, 8)
                                .addComponent(btnModificar, javax.swing.GroupLayout.PREFERRED_SIZE, 133, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btnAlta, javax.swing.GroupLayout.PREFERRED_SIZE, 128, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnlSalasLayout.createSequentialGroup()
                                .addGap(142, 142, 142)
                                .addComponent(btnBaja, javax.swing.GroupLayout.PREFERRED_SIZE, 133, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(18, 18, 18)
                        .addComponent(btnSalir, javax.swing.GroupLayout.PREFERRED_SIZE, 69, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(pnlSalasLayout.createSequentialGroup()
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                .addGroup(pnlSalasLayout.createSequentialGroup()
                                    .addComponent(lblNumero)
                                    .addGap(31, 31, 31)
                                    .addComponent(txtNumero))
                                .addGroup(pnlSalasLayout.createSequentialGroup()
                                    .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(lblCapacidad)
                                        .addComponent(lblEstado)
                                        .addComponent(lblApta3D))
                                    .addGap(18, 18, 18)
                                    .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addGroup(pnlSalasLayout.createSequentialGroup()
                                            .addComponent(jLabel1)
                                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                            .addComponent(jLabel2))
                                        .addComponent(txtCapacidad)
                                        .addGroup(pnlSalasLayout.createSequentialGroup()
                                            .addComponent(checkApta3D)
                                            .addGap(0, 0, Short.MAX_VALUE))
                                        .addComponent(txtEstado))))
                            .addComponent(checkEdicion))
                        .addGap(18, 18, 18)
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblSalasActuales)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        pnlSalasLayout.setVerticalGroup(
            pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlSalasLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(lblSalasActuales)
                .addGap(11, 11, 11)
                .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(pnlSalasLayout.createSequentialGroup()
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblNumero)
                            .addComponent(txtNumero, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel1)
                            .addComponent(jLabel2))
                        .addGap(5, 5, 5)
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblCapacidad)
                            .addComponent(txtCapacidad, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(39, 39, 39)
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblEstado)
                            .addComponent(txtEstado, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(40, 40, 40)
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblApta3D)
                            .addComponent(checkApta3D))
                        .addGap(27, 27, 27)
                        .addComponent(checkEdicion))
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnlSalasLayout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnAgregar)
                            .addComponent(btnModificar)
                            .addComponent(btnAlta))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(pnlSalasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnEliminar)
                            .addComponent(btnBaja))
                        .addContainerGap(12, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnlSalasLayout.createSequentialGroup()
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(btnSalir)
                        .addGap(36, 36, 36))))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(pnlSalas, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 44, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlSalas, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void checkEdicionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_checkEdicionActionPerformed
        if (checkEdicion.isSelected()) {
            habilitarBotones();
        } else {
            deshabilitarBotones();
        }
    }//GEN-LAST:event_checkEdicionActionPerformed

    private void btnSalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSalirActionPerformed
        this.dispose();
    }//GEN-LAST:event_btnSalirActionPerformed

    private void btnEliminarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEliminarActionPerformed
        try {
            int seleccion = JOptionPane.showConfirmDialog(this, "¿Desea eliminar la sala seleccionada? Esta acción eliminara todos los asientos"
                    + " relacionados a esta sala.", "Confirmación", YES_NO_OPTION);
            if(seleccion == 0){
                maniSalas.eliminarSala(nro_sala);
                JOptionPane.showMessageDialog(this, "Eliminado correctamente");
            }
            
        } catch(Exception e){
            JOptionPane.showMessageDialog(this, e.getMessage(), "Error", WIDTH);
        } finally {
            rellenarTabla();
        }
    }//GEN-LAST:event_btnEliminarActionPerformed

    private void btnAltaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAltaActionPerformed
        try {
            maniSalas.darAltaSala(nro_sala);
        } catch(Exception e){
            JOptionPane.showMessageDialog(this, e.getMessage(), "Error", WIDTH);
        } finally {
            rellenarTabla();
        }
    }//GEN-LAST:event_btnAltaActionPerformed

    private void btnBajaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnBajaActionPerformed
        try {
            maniSalas.darBajaSala(nro_sala);
        } catch(Exception e){
            JOptionPane.showMessageDialog(this, e.getMessage(), "Error", WIDTH);
        } finally {
            rellenarTabla();
        }
    }//GEN-LAST:event_btnBajaActionPerformed

    private void btnModificarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnModificarActionPerformed
        String txtNum = txtNumero.getText();
        String txtCap = txtCapacidad.getText();
        boolean es3d = checkApta3D.isSelected();
        boolean estado = parsearString(txtEstado.getText());
        try {
            int numeroSala = Integer.parseInt(txtNum);
            int capacidad = Integer.parseInt(txtCap);
            if(capacidad < 170 || capacidad > 230){
                JOptionPane.showMessageDialog(this, "Ingrese entre los valores validos la capacidad.");
                return;
            }
            Sala salaNueva = new Sala(numeroSala, capacidad, estado, es3d);
            maniSalas.actualizarSala(nro_sala, salaNueva);
        } catch (NumberFormatException a){
            JOptionPane.showMessageDialog(this, "Ingrese un número valido");
        } 
        
        catch(Exception e){
            JOptionPane.showMessageDialog(this, e.getMessage(), "Error", WIDTH);
        } 
        
        finally {
            rellenarTabla();
        }
    }//GEN-LAST:event_btnModificarActionPerformed

    private void btnAgregarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAgregarActionPerformed
        JFrame padre = (JFrame) SwingUtilities.getWindowAncestor(this);
        DialogCrearSala ventanaCrearSala = new DialogCrearSala(padre, true);
        ventanaCrearSala.setVisible(true);
        ventanaCrearSala.setLocationRelativeTo(padre);
        rellenarTabla();
    }//GEN-LAST:event_btnAgregarActionPerformed

    public void rellenarCabeceras() {
        DefaultTableModel modelo = new DefaultTableModel() {
            @Override
            public boolean isCellEditable(int row, int column) {
                return false;
            }
        };
        modelo.addColumn("Numero sala");
        modelo.addColumn("Capacidad");
        modelo.addColumn("Estado");
        modelo.addColumn("Apta 3D");
        tblSalas.setModel(modelo);
    }

    public void rellenarTabla() {
        try {
            DefaultTableModel modelo = (DefaultTableModel) tblSalas.getModel();
            modelo.setRowCount(0);
            List<Sala> listaSalas = maniSalas.listarsalas();
            for (Sala s : listaSalas) {
                modelo.addRow(new Object[] {s.getNro_Sala(), 
                    s.getCapacidad(), 
                    parsearBoolean(s.isEstado()),
                    parsearBoolean(s.isApta3D()),
                    
                });
            }
        } catch (Exception e) {

        }

    }

    public String parsearBoolean(boolean estado){
        if(estado){
            return "Activo";
        } 
            return "Inactivo";
    } 
    
    public boolean parsearString(String estado){
        return estado.equalsIgnoreCase("Activo");
    }
    
    public void deshabilitarBotones() {
        txtNumero.setEnabled(false);
        txtCapacidad.setEnabled(false);
        checkApta3D.setEnabled(false);
    }

    public void habilitarBotones() {
        txtNumero.setEnabled(true);
        txtCapacidad.setEnabled(true);
        checkApta3D.setEnabled(true);
    }
    
    public void agregarListenerTablaSala(JTable tabla){
        tblSalas.getSelectionModel().addListSelectionListener(new ListSelectionListener(){
            @Override
            public void valueChanged(ListSelectionEvent evento){
                if(evento.getValueIsAdjusting()){
                    return;
                }
                
                int filaS =  tabla.getSelectedRow();
                if(filaS != -1){
                    nro_sala = (int) tabla.getValueAt(filaS, 0);
                    txtNumero.setText(Integer.toString((int) tabla.getValueAt(filaS, 0)));
                    txtCapacidad.setText(Integer.toString((int) tabla.getValueAt(filaS, 1)));
                    txtEstado.setText((String) tabla.getValueAt(filaS, 2));
                    if(parsearString((String)tabla.getValueAt(filaS, 3))){
                        checkApta3D.setSelected(true);
                    } else {
                        checkApta3D.setSelected(false);
                    }
                }
            }
        });
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAgregar;
    private javax.swing.JButton btnAlta;
    private javax.swing.JButton btnBaja;
    private javax.swing.JButton btnEliminar;
    private javax.swing.JButton btnModificar;
    private javax.swing.JButton btnSalir;
    private javax.swing.JCheckBox checkApta3D;
    private javax.swing.JCheckBox checkEdicion;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lblApta3D;
    private javax.swing.JLabel lblCapacidad;
    private javax.swing.JLabel lblEstado;
    private javax.swing.JLabel lblNumero;
    private javax.swing.JLabel lblSalasActuales;
    private javax.swing.JPanel pnlSalas;
    private javax.swing.JTable tblSalas;
    private javax.swing.JTextField txtCapacidad;
    private javax.swing.JTextField txtEstado;
    private javax.swing.JTextField txtNumero;
    // End of variables declaration//GEN-END:variables
}
